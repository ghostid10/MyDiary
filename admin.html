<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Diary Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-50 p-5">
    <div class="max-w-md mx-auto bg-white p-6 rounded-3xl shadow-lg">
        <h2 class="text-xl font-bold text-pink-500 mb-4">á€…á€¬á€á€…á€ºá€á€„á€ºá€™á€šá€º âœï¸</h2>
        
        <input id="postTitle" type="text" placeholder="á€á€±á€«á€„á€ºá€¸á€…á€‰á€º" class="w-full p-3 border rounded-xl mb-3 outline-none focus:border-pink-400">
        <textarea id="postContent" placeholder="á€™á€„á€ºá€¸á€›á€²á€·á€›á€„á€ºá€–á€½á€„á€·á€ºá€…á€¬..." class="w-full p-3 border rounded-xl mb-3 h-32 outline-none focus:border-pink-400"></textarea>
        
        <button onclick="uploadPost()" class="w-full bg-pink-500 text-white font-bold py-3 rounded-xl hover:bg-pink-600 transition">Post á€á€„á€ºá€™á€šá€º</button>

        <hr class="my-6">

        <h2 class="text-xl font-bold text-gray-700 mb-4">á€á€„á€ºá€•á€¼á€®á€¸á€á€¬á€¸á€…á€¬á€™á€»á€¬á€¸ (á€–á€»á€€á€ºá€›á€”á€º) ğŸ—‘ï¸</h2>
        <div id="adminPostList" class="space-y-3">
            </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCRUag3lfCii8IHnNGsW2TvcK-b8_YuqUY",
            authDomain: "oursecretdiary-d767a.firebaseapp.com",
            databaseURL: "https://oursecretdiary-d767a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "oursecretdiary-d767a",
            storageBucket: "oursecretdiary-d767a.firebasestorage.app",
            messagingSenderId: "610893709105",
            appId: "1:610893709105:web:ed7a66d562c8f2383cfa10"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // á€•á€­á€¯á€·á€…á€ºá€á€„á€ºá€á€²á€· Function
        function uploadPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            if(!title || !content) return alert("á€…á€¬á€¡á€›á€„á€ºá€–á€¼á€Šá€·á€ºá€•á€«á€¦á€¸");

            const newPostRef = database.ref('allPosts').push();
            newPostRef.set({
                id: newPostRef.key, // ID á€á€­á€™á€ºá€¸á€‘á€¬á€¸á€™á€¾ á€–á€»á€€á€ºá€œá€­á€¯á€·á€›á€™á€¾á€¬
                title: title,
                content: content,
                timestamp: Date.now()
            }).then(() => {
                alert("á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®!");
                document.getElementById('postTitle').value = "";
                document.getElementById('postContent').value = "";
            });
        }

        // á€•á€­á€¯á€·á€…á€ºá€á€½á€±á€€á€­á€¯ á€–á€»á€€á€ºá€–á€­á€¯á€·á€¡á€á€½á€€á€º á€†á€½á€²á€‘á€¯á€á€ºá€•á€¼á€á€²á€· Function
        database.ref('allPosts').on('value', (snap) => {
            const list = document.getElementById('adminPostList');
            list.innerHTML = "";
            snap.forEach(child => {
                const post = child.val();
                list.innerHTML += `
                    <div class="p-3 border rounded-xl flex justify-between items-center bg-pink-50">
                        <div>
                            <p class="font-bold text-sm">${post.title}</p>
                            <p class="text-xs text-gray-500">${post.content.substring(0, 30)}...</p>
                        </div>
                        <button onclick="deletePost('${child.key}')" class="bg-red-500 text-white text-xs px-3 py-1 rounded-lg">á€–á€»á€€á€ºá€™á€šá€º</button>
                    </div>
                `;
            });
        });

        // á€•á€­á€¯á€·á€…á€ºá€–á€»á€€á€ºá€á€²á€· Function
        function deletePost(id) {
            if(confirm("á€á€€á€šá€ºá€–á€»á€€á€ºá€™á€¾á€¬á€œá€¬á€¸?")) {
                database.ref('allPosts/' + id).remove();
            }
        }
    </script>
</body>
</html>