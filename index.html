<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Putuu</title>
    
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Our%20Diary%22,%22short_name%22:%22Diary%22,%22start_url%22:%22/index.html%22,%22display%22:%22standalone%22,%22background_color%22:%22#020205%22,%22theme_color%22:%22#4338ca%22,%22icons%22:[{%22src%22:%22profile.jpg%22,%22sizes%22:%22192x192%22,%22type%22:%22image/jpg%22}]} ">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Padauk', sans-serif; 
            background: radial-gradient(circle at top, #1a1a2e 0%, #020205 100%);
            color: #1a1a2e; 
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* á€€á€¼á€šá€ºá€œá€±á€¸á€™á€»á€¬á€¸ */
        .stars-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        /* á€œá€á€¼á€™á€ºá€¸á€•á€¯á€¶á€œá€±á€¸ (Crescent Moon) */
        .moon-container {
            position: fixed; top: 40px; right: 40px; width: 50px; height: 50px;
            z-index: -1; filter: drop-shadow(0 0 15px rgba(254, 243, 199, 0.5));
            transform: rotate(-15deg);
        }

        /* ğŸš€ 3D Floating Box Style */
        .floating-3d {
            background: #ffffff;
            border-radius: 2rem;
            box-shadow: 0 18px 35px rgba(0, 0, 0, 0.6), 0 5px 12px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* á€”á€¾á€­á€•á€ºá€œá€­á€¯á€€á€ºá€›á€„á€º á€€á€¼á€½á€œá€¬á€•á€¼á€®á€¸ á€•á€¼á€”á€ºá€–á€­á€œá€­á€¯á€€á€ºá€á€œá€­á€¯á€–á€¼á€…á€ºá€…á€±á€›á€”á€º */
        .pop-on-click:hover { transform: translateY(-6px) scale(1.02); }
        .pop-on-click:active {
            transform: translateY(2px) scale(0.98);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5);
        }

        .diary-pill {
            background: #ffffff; padding: 10px 22px; border-radius: 50px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            font-size: 11px; font-weight: 800; color: #4338ca; border: 2px solid #4338ca;
        }

        .quote-box-3d {
            background: linear-gradient(145deg, #2d3436, #000000);
            border-radius: 2.5rem; padding: 2rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .reading-box {
            background-color: #ffffff !important; border-radius: 2.5rem;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.9);
        }

        .heart { position: absolute; color: #ff4d6d; pointer-events: none; animation: heartFloat 3s linear infinite; }
        @keyframes heartFloat {
            0% { transform: translateY(0) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-130px) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body class="p-6 pb-24">

    <div class="stars-container" id="starsContainer"></div>
    <div class="moon-container">
        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 15 C30 15 15 35 15 55 C15 75 30 95 55 95 C40 85 35 65 35 50 C35 35 45 20 65 10 C60 12 55 15 50 15Z" fill="#fef3c7" />
        </svg>
    </div>

    <div class="max-w-[450px] mx-auto space-y-12">
        <div class="flex justify-between items-center pt-4 gap-2">
            <div class="floating-3d px-5 py-3 text-[10px] font-bold pop-on-click text-indigo-900">á€•á€°á€á€°á€¸á€œá€±á€¸á€‘á€¶á€á€­á€¯á€· â¤ï¸</div>
            <div class="diary-pill pop-on-click">âœ¨ á€á€­á€¯á€·á€”á€¾á€…á€ºá€šá€±á€¬á€€á€ºá€›á€²á€· á€’á€­á€¯á€„á€ºá€šá€¬á€›á€® âœ¨</div>
            <div class="w-14 h-14 rounded-2xl overflow-hidden border-4 border-white shadow-2xl pop-on-click">
                <img src="profile.jpg" class="w-full h-full object-cover">
            </div>
        </div>

        <div class="quote-box-3d text-center pop-on-click relative overflow-hidden" id="heartContainer">
            <p class="text-white italic text-[14px] leading-relaxed font-bold">
                "á€¡á€á€»á€­á€”á€ºá€á€½á€± á€˜á€šá€ºá€œá€±á€¬á€€á€ºá€•á€² á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€•á€«á€…á€±...<br>á€™á€„á€ºá€¸á€¡á€•á€±á€«á€ºá€‘á€¬á€¸á€á€²á€· á€„á€«á€·á€¡á€á€»á€…á€ºá€á€½á€±á€€á€á€±á€¬á€· á€‘á€¬á€á€›á€•á€«"
            </p>
        </div>

        <div class="grid grid-cols-3 gap-5">
            <div class="floating-3d p-6 text-center pop-on-click">
                <p class="text-[9px] text-indigo-600 font-black uppercase tracking-widest">Birthday</p>
                <p class="text-[13px] font-bold text-black mt-2">07.07.2021</p>
            </div>
            <div class="floating-3d p-6 text-center pop-on-click">
                <p class="text-[9px] text-indigo-600 font-black uppercase tracking-widest">á€¡á€™á€¾á€á€ºá€á€›</p>
                <p class="text-[13px] font-bold text-indigo-900 mt-2">á€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬ â¤ï¸</p>
            </div>
            <div class="bg-indigo-900 p-6 text-center rounded-[2rem] shadow-2xl pop-on-click border border-white/10">
                <p class="text-[8px] text-indigo-200 font-black uppercase tracking-widest">Love Days</p>
                <p id="counter" class="text-[12px] font-bold text-white mt-2"></p>
            </div>
        </div>

        <div class="floating-3d p-7 flex items-center justify-between">
            <div class="flex flex-col">
                <span class="text-[10px] text-indigo-500 font-black">PLAYING</span>
                <span class="text-[14px] font-black text-black">SONG <span id="trackNo">1</span></span>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="prevSong()" class="w-11 h-11 bg-white rounded-2xl flex items-center justify-center text-indigo-900 shadow-lg pop-on-click border border-gray-100">
                    <span class="text-xl">â®</span>
                </button>
                <button onclick="toggleMusic()" class="w-14 h-14 bg-indigo-50 rounded-full flex items-center justify-center text-indigo-900 shadow-xl pop-on-click border-2 border-white">
                    <span id="playIcon" class="text-2xl">â¸</span>
                </button>
                <button onclick="nextSong()" class="w-11 h-11 bg-white rounded-2xl flex items-center justify-center text-indigo-900 shadow-lg pop-on-click border border-gray-100">
                    <span class="text-xl">â­</span>
                </button>
            </div>
            <audio id="bgMusic" onended="nextSong()"></audio>
        </div>

        <div class="space-y-8" id="latestPosts"></div>

        <div class="pt-10 border-t border-white/20">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-[13px] font-black text-indigo-200 uppercase tracking-widest italic">á€á€­á€™á€ºá€¸á€‘á€¬á€¸á€á€™á€»á€¾</h3>
                <button onclick="toggleArchive()" id="archiveBtn" class="floating-3d px-6 py-3 text-[11px] font-bold text-indigo-900 pop-on-click">á€€á€¼á€Šá€·á€ºá€›á€”á€º â†“</button>
            </div>
            <div id="archiveContainer" class="hidden space-y-6"></div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-4 backdrop-blur-xl" onclick="closeModal()">
        <div class="reading-box p-10 max-w-[480px] w-full max-h-[85vh] overflow-y-auto" onclick="event.stopPropagation()">
            <img id="modal-img" class="hidden w-full h-72 object-cover rounded-[2rem] mb-8 shadow-2xl">
            <h2 id="modal-title" class="text-center mb-6 font-bold text-3xl text-black"></h2>
            <div class="h-[4px] w-16 bg-indigo-600 mx-auto mb-10 rounded-full"></div>
            <p id="modal-content" class="whitespace-pre-line leading-[2.4] font-bold text-gray-900 text-[19px] px-2"></p>
            <button onclick="closeModal()" class="w-full mt-14 bg-black py-5 text-white rounded-[1.5rem] font-black text-[16px] pop-on-click shadow-2xl">á€•á€¼á€”á€ºá€•á€­á€á€ºá€›á€”á€º</button>
        </div>
    </div>

    <script>
        // Stars Logic
        function createStars() {
            const container = document.getElementById('starsContainer');
            for(let i=0; i<150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 'px';
                star.style.width = size; star.style.height = size;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--duration', Math.random() * 3 + 2 + 's');
                container.appendChild(star);
            }
        }
        createStars();

        // Firebase Configuration (Keep yours)
        const firebaseConfig = {
            apiKey: "AIzaSyCRUag3lfCii8IHnNGsW2TvcK-b8_YuqUY",
            authDomain: "oursecretdiary-d767a.firebaseapp.com",
            databaseURL: "https://oursecretdiary-d767a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "oursecretdiary-d767a",
            storageBucket: "oursecretdiary-d767a.firebasestorage.app",
            messagingSenderId: "610893709105",
            appId: "1:610893709105:web:ed7a66d562c8f2383cfa10"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Core Logic
        let track = 1;
        const player = document.getElementById('bgMusic');
        function loadSong(t) {
            player.src = `song${t}.mp3`;
            document.getElementById('trackNo').innerText = t;
            player.play().catch(() => { document.getElementById('playIcon').innerText = "â–¶"; });
        }
        loadSong(track);

        function toggleMusic() {
            const icon = document.getElementById('playIcon');
            if(player.paused) { player.play(); icon.innerText = "â¸"; } else { player.pause(); icon.innerText = "â–¶"; }
        }
        function nextSong() { track = track < 5 ? track + 1 : 1; loadSong(track); }
        function prevSong() { track = track > 1 ? track - 1 : 5; loadSong(track); }

        function updateCounter() {
            const start = new Date("2024-05-21");
            const diff = new Date() - start;
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff / 3600000) % 24);
            const m = Math.floor((diff / 60000) % 60);
            document.getElementById('counter').innerText = `${d}d ${h}h ${m}m`;
        }
        setInterval(updateCounter, 1000); updateCounter();

        function spawnHeart() {
            const container = document.getElementById('heartContainer');
            const h = document.createElement('div');
            h.innerHTML = "â¤ï¸"; h.className = "heart";
            h.style.left = Math.random() * 80 + 10 + "%"; h.style.bottom = "0px";
            container.appendChild(h);
            setTimeout(() => h.remove(), 3000);
        }
        setInterval(spawnHeart, 700);

        // Posts
        database.ref('allPosts').limitToLast(5).on('value', snap => {
            const container = document.getElementById('latestPosts');
            container.innerHTML = `<h3 class="text-[13px] font-black text-indigo-200 uppercase tracking-widest italic ml-2 mb-6">á€œá€á€ºá€á€œá€±á€¬ á€…á€¬á€…á€¯á€œá€±á€¸á€™á€»á€¬á€¸</h3>`;
            let posts = [];
            snap.forEach(c => { let d = c.val(); d.key = c.key; posts.unshift(d); });
            posts.forEach(p => {
                container.innerHTML += `
                    <div class="floating-3d p-8 pop-on-click mb-8" onclick="openFull('${p.key}')">
                        <h4 class="font-black text-black text-[17px] mb-4 leading-tight">${p.title || 'Untitled'}</h4>
                        <p class="text-gray-600 text-[13px] line-clamp-2 mb-4 font-bold">${p.content || ''}</p>
                        <span class="text-indigo-700 text-[11px] font-black tracking-widest">á€–á€á€ºá€›á€”á€º â†’</span>
                    </div>`;
            });
        });

        // Archive & Modal
        function toggleArchive() {
            const container = document.getElementById('archiveContainer');
            const btn = document.getElementById('archiveBtn');
            if(container.classList.contains('hidden')) {
                container.classList.remove('hidden'); btn.innerText = "á€•á€¼á€”á€ºá€á€­á€™á€ºá€¸á€›á€”á€º â†‘"; loadNestedArchive();
            } else {
                container.classList.add('hidden'); btn.innerText = "á€€á€¼á€Šá€·á€ºá€›á€”á€º â†“";
            }
        }

        function loadNestedArchive() {
            database.ref('allPosts').on('value', snap => {
                const container = document.getElementById('archiveContainer');
                container.innerHTML = "";
                let structure = {};
                snap.forEach(child => {
                    let post = child.val(); post.key = child.key;
                    let d = new Date(post.timestamp || Date.now());
                    let year = d.getFullYear(), month = d.toLocaleString('en-US', {month:'long'});
                    if(!structure[year]) structure[year] = {};
                    if(!structure[year][month]) structure[year][month] = [];
                    structure[year][month].unshift(post);
                });
                for (let year in structure) {
                    let yearHTML = `<div class="floating-3d p-6 mb-6"><div class="font-black text-indigo-900 text-lg mb-4">ğŸ“ ${year}</div>`;
                    for (let month in structure[year]) {
                        yearHTML += `<div class="text-[13px] font-bold text-gray-400 mb-3">ğŸ“… ${month}</div><div class="space-y-3 mb-6">`;
                        structure[year][month].forEach(p => {
                            yearHTML += `<div onclick="openFull('${p.key}')" class="bg-indigo-50 p-4 rounded-2xl text-[13px] text-indigo-900 font-black pop-on-click shadow-sm">ğŸ’Œ ${p.title || 'Untitled'}</div>`;
                        });
                        yearHTML += `</div>`;
                    }
                    yearHTML += `</div>`; container.innerHTML += yearHTML;
                }
            });
        }

        function openFull(key) {
            database.ref('allPosts/'+key).once('value', snap => {
                const p = snap.val(); if(!p) return;
                document.getElementById('modal-title').innerText = p.title || 'Memory';
                document.getElementById('modal-content').innerText = p.content || '';
                const img = document.getElementById('modal-img');
                if(p.imageUrl) { img.src = p.imageUrl; img.classList.remove('hidden'); } else img.classList.add('hidden');
                document.getElementById('modal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); document.body.style.overflow = 'auto'; }
    </script>
</body>
</html>