<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Secret Diary</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OurDiary">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="profile.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Padauk', sans-serif; background: #020205; color: #ffffff; min-height: 100vh; -webkit-tap-highlight-color: transparent; }

        /* âœ¨ 3D Neumorphism & Glassmorphism */
        .floating-3d {
            background: rgba(255, 255, 255, 0.95); border-radius: 24px;
            box-shadow: 12px 12px 25px rgba(0, 0, 0, 0.7), -4px -4px 15px rgba(255, 255, 255, 0.05);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: #1e1b4b;
        }

        .button-3d {
            background: #ffffff; border-radius: 14px;
            box-shadow: 0 6px 0 #cbd5e1, 0 10px 20px rgba(0,0,0,0.5);
            transition: all 0.1s; cursor: pointer;
        }
        .button-3d:active { transform: translateY(4px); box-shadow: 0 1px 0 #cbd5e1; }

        /* ğŸ’¬ Chat Bubbles */
        #chat-container { height: 260px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px; }
        .msg { padding: 10px 14px; border-radius: 18px; font-size: 11px; font-weight: bold; max-width: 80%; }
        .msg-me { background: #4338ca; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .msg-them { background: #f1f5f9; color: #1e1b4b; align-self: flex-start; border-bottom-left-radius: 2px; }

        /* ğŸ“‚ Organized Archive */
        .archive-year { background: #1e1b4b; padding: 12px 20px; border-radius: 15px; margin-bottom: 10px; cursor: pointer; font-weight: 900; border: 1px solid #4338ca; }
        .archive-month { background: #2e2a5e; padding: 10px 20px; border-radius: 12px; margin: 5px 0 5px 20px; cursor: pointer; font-size: 13px; }
        .memory-entry { background: #ffffff; color: #1e1b4b; padding: 15px; border-radius: 15px; margin: 5px 0 5px 40px; border-left: 4px solid #4338ca; box-shadow: 5px 5px 15px rgba(0,0,0,0.2); }
        
        #modal { background: rgba(0,0,0,0.95); backdrop-blur: 10px; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-[450px] mx-auto space-y-6 pb-28">
        <div class="flex justify-between items-center gap-2">
            <div class="button-3d px-3 py-2 text-[8px] font-bold text-indigo-900">á€•á€°á€á€°á€¸á€œá€±á€¸á€‘á€¶á€á€­á€¯á€· â¤ï¸</div>
            <div class="floating-3d bg-white px-4 py-2 rounded-full text-[10px] font-black text-indigo-700 flex-1 text-center">âœ¨ á€á€­á€¯á€·á€”á€¾á€…á€ºá€šá€±á€¬á€€á€ºá€›á€²á€· á€’á€­á€¯á€„á€ºá€šá€¬á€›á€® âœ¨</div>
            <div class="w-10 h-10 rounded-xl overflow-hidden border-2 border-white shadow-2xl"><img src="profile.jpg" class="w-full h-full object-cover"></div>
        </div>

        <div class="floating-3d p-4 bg-slate-900/80 text-center border border-indigo-500/30">
            <p class="text-white italic text-[11px] font-bold">"á€™á€„á€ºá€¸á€¡á€•á€±á€«á€ºá€‘á€¬á€¸á€á€²á€· á€„á€«á€·á€¡á€á€»á€…á€ºá€á€½á€±á€€ á€‘á€¬á€á€›á€•á€«"</p>
        </div>

        <div class="flex gap-4 items-stretch">
            <div class="flex-[1.8] floating-3d p-4 flex flex-col">
                <h3 class="text-[9px] font-black text-indigo-600 mb-2 uppercase">ğŸ’¬ Secret Chat</h3>
                <div id="chat-container" class="bg-slate-50/50 rounded-2xl mb-2"></div>
                <div class="flex gap-1">
                    <input id="chatInput" type="text" placeholder="á€…á€¬á€›á€­á€¯á€€á€ºá€•á€«..." class="w-full bg-slate-100 rounded-xl px-3 py-2 text-[10px] outline-none text-black">
                    <button onclick="sendMessage()" class="button-3d bg-indigo-600 text-white px-4 text-[10px] font-bold">á€•á€­á€¯á€·</button>
                </div>
            </div>

            <div class="flex-1 flex flex-col gap-3">
                <div class="floating-3d p-3 flex flex-col items-center justify-center bg-slate-50/50 flex-1">
                    <span class="text-[8px] text-indigo-500 font-black mb-3">SONGS</span>
                    <button onclick="toggleMusic()" class="button-3d w-12 h-12 rounded-full flex items-center justify-center text-indigo-900"><span id="playIcon">â¸</span></button>
                    <div class="flex gap-2 w-full mt-4">
                        <button onclick="prevSong()" class="button-3d flex-1 py-2 text-xs">â®</button>
                        <button onclick="nextSong()" class="button-3d flex-1 py-2 text-xs">â­</button>
                    </div>
                    <audio id="bgMusic" onended="nextSong()"></audio>
                </div>
                <div class="floating-3d bg-indigo-950 p-3 text-center border-b-4 border-indigo-900">
                    <p class="text-[7px] text-indigo-300 font-black">LOVE DAYS</p>
                    <p id="counter" class="text-[13px] font-black text-white"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-[400px] z-50">
        <div onclick="toggleMemories()" class="button-3d p-4 text-center bg-white border-2 border-indigo-100">
            <p class="text-xs text-indigo-700 font-black tracking-widest">MEMORIES â¤ï¸</p>
            <p class="text-[9px] text-slate-400 font-bold">á€¡á€™á€¾á€á€ºá€á€›á€™á€»á€¬á€¸á€€á€­á€¯ á€¡á€á€»á€­á€”á€ºá€¡á€œá€­á€¯á€€á€º á€›á€½á€±á€¸á€–á€á€ºá€›á€”á€º</p>
        </div>
    </div>

    <div id="memories-overlay" class="hidden fixed inset-0 z-[100] p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-8 border-b border-indigo-800 pb-4">
            <div>
                <h3 class="text-indigo-400 font-black text-xl tracking-tighter">Diary Archive</h3>
                <p class="text-[10px] text-indigo-200 opacity-60">á€¡á€á€»á€­á€”á€ºá€€á€¬á€œá€¡á€œá€­á€¯á€€á€º á€…á€”á€…á€ºá€á€€á€» á€™á€¾á€á€ºá€á€™á€ºá€¸á€á€„á€ºá€‘á€¬á€¸á€á€Šá€º</p>
            </div>
            <button onclick="toggleMemories()" class="w-10 h-10 rounded-full bg-indigo-900/50 text-white font-bold">âœ•</button>
        </div>
        <div id="archive-container" class="pb-24"></div>
    </div>

    <div id="modal" class="hidden fixed inset-0 z-[200] flex items-center justify-center p-6">
        <div class="bg-white rounded-[30px] p-8 max-w-[360px] w-full shadow-2xl relative text-indigo-950">
            <h2 id="modal-title" class="text-xl font-black mb-1"></h2>
            <p id="modal-date" class="text-[10px] text-slate-400 mb-4 font-bold"></p>
            <div id="modal-image-container" class="mb-4 hidden">
                <img id="modal-image" class="w-full rounded-2xl shadow-lg border-4 border-white" src="">
            </div>
            <div id="modal-content" class="text-[14px] leading-relaxed max-h-[300px] overflow-y-auto pr-2"></div>
            <button onclick="closeModal()" class="w-full mt-8 button-3d py-4 font-black bg-indigo-600 text-white">á€•á€­á€á€ºá€™á€Šá€º</button>
        </div>
    </div>

    <script>
        // --- Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyCRUag3lfCii8IHnNGsW2TvcK-b8_YuqUY",
            authDomain: "oursecretdiary-d767a.firebaseapp.com",
            databaseURL: "https://oursecretdiary-d767a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "oursecretdiary-d767a",
            storageBucket: "oursecretdiary-d767a.firebasestorage.app",
            messagingSenderId: "610893709105",
            appId: "1:610893709105:web:ed7a66d562c8f2383cfa10"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        if(!localStorage.getItem('myChatId')) localStorage.setItem('myChatId', 'u_' + Math.random().toString(36).substr(2, 5));
        const myId = localStorage.getItem('myChatId');

        // --- Archive Logic ---
        function toggleMemories() { document.getElementById('memories-overlay').classList.toggle('hidden'); }

        database.ref('allPosts').on('value', snap => {
            const container = document.getElementById('archive-container');
            container.innerHTML = "";
            let archive = {};
            snap.forEach(c => {
                const p = c.val();
                const d = new Date(p.timestamp || Date.now());
                const year = d.getFullYear();
                const month = d.toLocaleString('my-MM', { month: 'long' });
                if(!archive[year]) archive[year] = {};
                if(!archive[year][month]) archive[year][month] = [];
                archive[year][month].push({...p, key: c.key, dateStr: d.toLocaleDateString('my-MM', { day: 'numeric', month: 'short', year: 'numeric' })});
            });

            Object.keys(archive).sort((a,b) => b-a).forEach(year => {
                const yearDiv = document.createElement('div');
                yearDiv.className = "archive-year";
                yearDiv.innerHTML = `ğŸ“… ${year} á€á€¯á€”á€¾á€…á€º`;
                const monthContainer = document.createElement('div');
                monthContainer.className = "hidden";
                yearDiv.onclick = () => monthContainer.classList.toggle('hidden');
                Object.keys(archive[year]).forEach(month => {
                    const monthDiv = document.createElement('div');
                    monthDiv.className = "archive-month";
                    monthDiv.innerHTML = `ğŸŒ™ ${month}`;
                    const postContainer = document.createElement('div');
                    postContainer.className = "hidden";
                    monthDiv.onclick = (e) => { e.stopPropagation(); postContainer.classList.toggle('hidden'); };
                    archive[year][month].sort((a,b) => b.timestamp - a.timestamp).forEach(post => {
                        const entry = document.createElement('div');
                        entry.className = "memory-entry";
                        entry.innerHTML = `<div class="font-black text-sm">${post.title}</div><div class="text-[10px] opacity-60">${post.dateStr}</div>`;
                        entry.onclick = (e) => { e.stopPropagation(); openModal(post); };
                        postContainer.appendChild(entry);
                    });
                    monthDiv.appendChild(postContainer);
                    monthContainer.appendChild(monthDiv);
                });
                container.appendChild(yearDiv);
                container.appendChild(monthContainer);
            });
        });

        function openModal(post) {
            document.getElementById('modal-title').innerText = post.title;
            document.getElementById('modal-date').innerText = new Date(post.timestamp).toLocaleString();
            document.getElementById('modal-content').innerText = post.content || '';
            const imgCont = document.getElementById('modal-image-container');
            const img = document.getElementById('modal-image');
            if(post.imageUrl) { img.src = post.imageUrl; imgCont.classList.remove('hidden'); }
            else { imgCont.classList.add('hidden'); }
            document.getElementById('modal').classList.remove('hidden');
        }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        // --- Chat ---
        function sendMessage() {
            const input = document.getElementById('chatInput');
            if(!input.value.trim()) return;
            database.ref('messages').push({ text: input.value.trim(), timestamp: Date.now(), senderId: myId });
            input.value = "";
        }
        database.ref('messages').limitToLast(15).on('value', snap => {
            const cont = document.getElementById('chat-container');
            cont.innerHTML = "";
            snap.forEach(c => {
                const m = c.val();
                const div = document.createElement('div');
                div.className = `msg ${m.senderId === myId ? 'msg-me' : 'msg-them'}`;
                div.innerText = m.text;
                cont.appendChild(div);
            });
            cont.scrollTop = cont.scrollHeight;
        });

        function updateCounter() {
            const d = Math.floor((new Date() - new Date("2024-05-21")) / 86400000);
            document.getElementById('counter').innerText = d + " Days";
        }
        updateCounter();

        // Music
        let track = 1; const player = document.getElementById('bgMusic');
        function loadSong(t) { player.src = `song${t}.mp3`; player.play().catch(()=>{}); }
        loadSong(track);
        function toggleMusic() {
            const btn = document.getElementById('playIcon');
            if(player.paused) { player.play(); btn.innerText = "â¸"; } else { player.pause(); btn.innerText = "â–¶"; }
        }
        function nextSong() { track = track < 5 ? track + 1 : 1; loadSong(track); }
        function prevSong() { track = track > 1 ? track - 1 : 5; loadSong(track); }
    </script>
</body>
</html>