<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Private Diary & Chat</title>
    
    <link rel="manifest" href="data:application/manifest+json,{%22name%22:%22Our%20Diary%22,%22short_name%22:%22Diary%22,%22start_url%22:%22./index.html%22,%22display%22:%22standalone%22,%22background_color%22:%22#020205%22,%22theme_color%22:%22#4338ca%22,%22icons%22:[{%22src%22:%22profile.jpg%22,%22sizes%22:%22192x192%22,%22type%22:%22image/jpg%22}]} ">
    <meta name="theme-color" content="#4338ca">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Padauk', sans-serif; 
            background: radial-gradient(circle at top, #1a1a2e 0%, #020205 100%);
            color: #1a1a2e; min-height: 100vh; scroll-behavior: smooth;
        }

        .stars-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--duration) infinite ease-in-out; }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(1); } 50% { opacity: 1; transform: scale(1.5); } }

        .moon-container { position: fixed; top: 40px; right: 40px; width: 50px; height: 50px; z-index: -1; filter: drop-shadow(0 0 15px rgba(254, 243, 199, 0.5)); transform: rotate(-15deg); }

        .floating-3d {
            background: #ffffff; border-radius: 2rem;
            box-shadow: 0 18px 35px rgba(0, 0, 0, 0.6), 0 5px 12px rgba(0, 0, 0, 0.4);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .pop-on-click:hover { transform: translateY(-6px) scale(1.02); }
        .pop-on-click:active { transform: translateY(2px) scale(0.98); }

        /* Chat Styles */
        #chat-container { height: 300px; overflow-y: auto; scroll-behavior: smooth; }
        .msg-bubble { padding: 10px 15px; border-radius: 18px; max-width: 80%; margin-bottom: 8px; font-weight: bold; font-size: 13px; }
        .msg-sent { background: #4338ca; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .msg-received { background: #f3f4f6; color: #1f2937; align-self: flex-start; border-bottom-left-radius: 4px; }

        .heart { position: absolute; color: #ff4d6d; pointer-events: none; animation: heartFloat 3s linear infinite; }
        @keyframes heartFloat { 0% { transform: translateY(0) scale(0); opacity: 0; } 100% { transform: translateY(-130px) scale(1.5); opacity: 0; } }
    </style>
</head>
<body class="p-6 pb-24">

    <div class="stars-container" id="starsContainer"></div>
    <div class="moon-container">
        <svg viewBox="0 0 100 100"><path d="M50 15 C30 15 15 35 15 55 C15 75 30 95 55 95 C40 85 35 65 35 50 C35 35 45 20 65 10 C60 12 55 15 50 15Z" fill="#fef3c7" /></svg>
    </div>

    <div class="max-w-[450px] mx-auto space-y-10">
        <div class="flex justify-between items-center pt-4">
            <div class="floating-3d px-5 py-3 text-[10px] font-bold pop-on-click text-indigo-900">For You ‚ù§Ô∏è</div>
            <div class="w-14 h-14 rounded-2xl overflow-hidden border-4 border-white shadow-2xl">
                <img src="profile.jpg" class="w-full h-full object-cover">
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4">
            <div class="floating-3d p-4 text-center"><p class="text-[8px] text-indigo-600 font-black">BIRTHDAY</p><p class="text-[11px] font-bold">07.07.2021</p></div>
            <div onclick="document.getElementById('latest-section').scrollIntoView();" class="floating-3d p-4 text-center bg-indigo-50 cursor-pointer"><p class="text-[8px] text-indigo-600 font-black">MEMORIES</p><p class="text-[11px] font-bold">·ÄÖ·Ä¨·Äô·Äª·ÄÄ·Ä∫·Äî·Äæ·Ä¨ ‚ù§Ô∏è</p></div>
            <div class="bg-indigo-900 p-4 text-center rounded-[1.5rem]"><p class="text-[8px] text-indigo-200 font-black">LOVE DAYS</p><p id="counter" class="text-[11px] font-bold text-white"></p></div>
        </div>

        <div class="floating-3d p-6 space-y-4">
            <h3 class="text-[12px] font-black text-indigo-600 uppercase tracking-widest flex items-center gap-2">
                üí¨ Secret Messages
            </h3>
            <div id="chat-container" class="flex flex-col pr-2">
                </div>
            <div class="flex gap-2 mt-2">
                <input id="chatInput" type="text" placeholder="·ÄÖ·Ä¨·Äú·Ä±·Ä∏·Äõ·Ä±·Ä∏·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äï·Ä´..." class="flex-1 bg-gray-100 border-none rounded-xl px-4 py-3 text-[13px] focus:ring-2 focus:ring-indigo-500 outline-none">
                <button onclick="sendMessage()" class="bg-indigo-600 text-white px-5 py-3 rounded-xl font-bold text-[13px] pop-on-click shadow-lg">·Äï·Ä≠·ÄØ·Ä∑·Äô·Äö·Ä∫</button>
            </div>
        </div>

        <div class="floating-3d p-6 flex items-center justify-between">
            <div class="flex flex-col"><span class="text-[10px] text-indigo-500 font-black">MUSIC</span><span class="text-[13px] font-black text-black">Track <span id="trackNo">1</span></span></div>
            <div class="flex items-center gap-3">
                <button onclick="prevSong()" class="w-10 h-10 bg-white rounded-xl shadow-md flex items-center justify-center pop-on-click">‚èÆ</button>
                <button onclick="toggleMusic()" class="w-12 h-12 bg-indigo-50 rounded-full shadow-lg flex items-center justify-center border-2 border-white pop-on-click"><span id="playIcon">‚è∏</span></button>
                <button onclick="nextSong()" class="w-10 h-10 bg-white rounded-xl shadow-md flex items-center justify-center pop-on-click">‚è≠</button>
            </div>
            <audio id="bgMusic" onended="nextSong()"></audio>
        </div>

        <div class="space-y-8" id="latest-section">
            <h3 class="text-[13px] font-black text-indigo-200 uppercase tracking-widest italic">Timeline</h3>
            <div id="latestPosts" class="space-y-8"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration (Same as yours)
        const firebaseConfig = {
            apiKey: "AIzaSyCRUag3lfCii8IHnNGsW2TvcK-b8_YuqUY",
            authDomain: "oursecretdiary-d767a.firebaseapp.com",
            databaseURL: "https://oursecretdiary-d767a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "oursecretdiary-d767a",
            storageBucket: "oursecretdiary-d767a.firebasestorage.app",
            messagingSenderId: "610893709105",
            appId: "1:610893709105:web:ed7a66d562c8f2383cfa10"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // --- Chat Logic ---
        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chatInput');

        function sendMessage() {
            const text = chatInput.value.trim();
            if (text === "") return;
            
            // ·ÄÖ·Ä¨·Äï·Ä≠·ÄØ·Ä∑·Äê·Ä≤·Ä∑·Äû·Ä∞·Äõ·Ä≤·Ä∑ ·Ä°·Äô·Ää·Ä∫·ÄÄ·Ä≠·ÄØ ·Äû·Äê·Ä∫·Äô·Äæ·Äê·Ä∫·Äî·Ä≠·ÄØ·ÄÑ·Ä∫·Äñ·Ä≠·ÄØ·Ä∑ (·Ä•·Äï·Äô·Ä¨- "A" ·Äû·Ä≠·ÄØ·Ä∑·Äô·Äü·ÄØ·Äê·Ä∫ "B")
            // ·Äú·Ä±·Ä¨·Äú·Ä±·Ä¨·ÄÜ·Äö·Ä∫ ·Äõ·Ä≠·ÄØ·Ä∏·Äõ·Ä≠·ÄØ·Ä∏·Äï·Ä≤ ·Äï·Ä≠·ÄØ·Ä∑·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äô·Äö·Ä∫
            database.ref('messages').push({
                text: text,
                timestamp: Date.now(),
                sender: "user1" // ·Äí·Ä´·ÄÄ·Ä≠·ÄØ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äï·Äº·ÄÆ·Ä∏ ·Äû·ÄØ·Ä∂·Ä∏·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äê·Äö·Ä∫
            });
            chatInput.value = "";
        }

        database.ref('messages').limitToLast(20).on('value', snap => {
            chatContainer.innerHTML = "";
            snap.forEach(child => {
                const msg = child.val();
                const div = document.createElement('div');
                div.className = `msg-bubble ${msg.sender === "user1" ? 'msg-sent' : 'msg-received'}`;
                div.innerText = msg.text;
                chatContainer.appendChild(div);
            });
            chatContainer.scrollTop = chatContainer.scrollHeight;
        });

        // Enter key ·Äî·Ä≤·Ä∑ ·ÄÖ·Ä¨·Äï·Ä≠·ÄØ·Ä∑·Äú·Ä≠·ÄØ·Ä∑·Äõ·Ä°·Ä±·Ä¨·ÄÑ·Ä∫
        chatInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") sendMessage();
        });

        // --- Visuals & Counter ---
        function createStars() {
            const container = document.getElementById('starsContainer');
            for(let i=0; i<100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.setProperty('--duration', Math.random() * 3 + 2 + 's');
                container.appendChild(star);
            }
        }
        createStars();

        function updateCounter() {
            const diff = new Date() - new Date("2024-05-21");
            const d = Math.floor(diff / 86400000);
            document.getElementById('counter').innerText = `${d} Days`;
        }
        setInterval(updateCounter, 1000); updateCounter();

        // --- Posts Logic ---
        database.ref('allPosts').limitToLast(5).on('value', snap => {
            const container = document.getElementById('latestPosts');
            container.innerHTML = "";
            let posts = [];
            snap.forEach(c => { let d = c.val(); d.key = c.key; posts.unshift(d); });
            posts.forEach(p => {
                container.innerHTML += `
                    <div class="floating-3d p-8 pop-on-click mb-8">
                        <h4 class="font-black text-black text-[16px] mb-3">${p.title || 'Memory'}</h4>
                        <p class="text-gray-600 text-[12px] font-bold line-clamp-2">${p.content || ''}</p>
                    </div>`;
            });
        });

        // --- Music Player Logic ---
        let track = 1; const player = document.getElementById('bgMusic');
        function loadSong(t) {
            player.src = `song${t}.mp3`; document.getElementById('trackNo').innerText = t;
            player.play().catch(() => {});
        }
        loadSong(track);
        function toggleMusic() {
            const icon = document.getElementById('playIcon');
            if(player.paused) { player.play(); icon.innerText = "‚è∏"; } else { player.pause(); icon.innerText = "‚ñ∂"; }
        }
        function nextSong() { track = track < 5 ? track + 1 : 1; loadSong(track); }
        function prevSong() { track = track > 1 ? track - 1 : 5; loadSong(track); }
    </script>
</body>
</html>