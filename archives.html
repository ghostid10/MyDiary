<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Archives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Padauk', sans-serif; background: #f0f2f5; scroll-behavior: smooth; }
        .archive-card { background: #ffffff; border-radius: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.03); transition: transform 0.2s; }
        .archive-card:active { transform: scale(0.98); }
        .month-header { position: sticky; top: 10px; z-index: 20; }
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(10px); }
        .modal-content-box { white-space: pre-line; scrollbar-width: thin; scrollbar-color: #ec4899 #f3f4f6; }
    </style>
</head>
<body class="pb-20">

    <div class="max-w-[500px] mx-auto p-6">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-pink-600 mb-2">üìÇ Memory Archives</h1>
            <p class="text-slate-400 text-xs tracking-widest uppercase">·Äê·Ä≠·ÄØ·Ä∑·Äî·Äæ·ÄÖ·Ä∫·Äö·Ä±·Ä¨·ÄÄ·Ä∫·Äõ·Ä≤·Ä∑ ·Ä°·Äô·Äæ·Äê·Ä∫·Äê·Äõ·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏</p>
        </header>

        <div id="archivesContainer">
            <div class="flex justify-center py-20">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"></div>
            </div>
        </div>
    </div>

    <div id="modal" onclick="closeModal()">
        <div class="bg-white p-8 rounded-[2.5rem] max-w-[450px] w-full mx-auto shadow-2xl relative animate-in fade-in zoom-in duration-300" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-pink-600 font-bold mb-5 border-b-2 border-pink-50 pb-4 text-xl text-center leading-relaxed"></h3>
            <div id="modal-content" class="modal-content-box text-black text-[17px] leading-[1.8] overflow-y-auto max-h-[480px] pr-2 text-justify font-bold tracking-tight"></div>
            <button onclick="closeModal()" class="mt-8 w-full bg-slate-950 text-white py-4 rounded-2xl font-bold uppercase tracking-widest active:scale-95 transition-all">Close</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCRUag3lfCii8IHnNGsW2TvcK-b8_YuqUY",
            authDomain: "oursecretdiary-d767a.firebaseapp.com",
            databaseURL: "https://oursecretdiary-d767a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "oursecretdiary-d767a",
            storageBucket: "oursecretdiary-d767a.firebasestorage.app",
            messagingSenderId: "610893709105",
            appId: "1:610893709105:web:ed7a66d562c8f2383cfa10"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        database.ref('allPosts').on('value', (snap) => {
            const container = document.getElementById('archivesContainer');
            container.innerHTML = "";
            
            if(!snap.exists()) {
                container.innerHTML = "<p class='text-center text-slate-400'>·Äô·Äæ·Äê·Ä∫·Äê·Äô·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏ ·Äô·Äõ·Äæ·Ä≠·Äû·Ä±·Ä∏·Äï·Ä´·Åã</p>";
                return;
            }

            let years = {};

            snap.forEach(c => {
                let data = c.val();
                data.key = c.key;
                
                let postDate = data.timestamp ? new Date(data.timestamp) : new Date();
                let year = postDate.getFullYear();
                let month = postDate.toLocaleString('en-US', { month: 'long' });

                if (!years[year]) years[year] = {};
                if (!years[year][month]) years[year][month] = [];
                
                years[year][month].unshift(data);
            });

            // ·Äî·Äæ·ÄÖ·Ä∫·Ä°·Äú·Ä≠·ÄØ·ÄÄ·Ä∫ Loop (·Ä°·Äû·ÄÖ·Ä∫·ÄÜ·ÄØ·Ä∂·Ä∏·Äî·Äæ·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ ·Ä°·Äï·Ä±·Ä´·Ä∫·Äê·ÄÑ·Ä∫·Äõ·Äî·Ä∫)
            const sortedYears = Object.keys(years).sort().reverse();

            sortedYears.forEach(year => {
                let yearSection = document.createElement('div');
                yearSection.className = "mb-12";
                yearSection.innerHTML = `<h2 class="text-5xl font-black text-slate-200 mb-6 drop-shadow-sm">${year}</h2>`;
                
                // ·Äú·Ä°·Äú·Ä≠·ÄØ·ÄÄ·Ä∫ Loop
                const months = Object.keys(years[year]); 
                // ·Äú·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ·Äú·Ää·Ä∫·Ä∏ ·Ä°·ÄÖ·Äâ·Ä∫·Äú·Ä≠·ÄØ·ÄÄ·Ä∫·Äñ·Äº·ÄÖ·Ä∫·Ä°·Ä±·Ä¨·ÄÑ·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äõ·ÄÑ·Ä∫ ·Äë·Äï·Ä∫·ÄÖ·ÄÆ·Äú·Ä≠·ÄØ·Ä∑·Äõ·Äï·Ä´·Äê·Äö·Ä∫

                months.forEach(month => {
                    let monthGroup = document.createElement('div');
                    monthGroup.className = "mb-10 pl-2";
                    monthGroup.innerHTML = `
                        <div class="month-header mb-6">
                            <span class="bg-pink-500 text-white px-5 py-1.5 rounded-full font-bold text-xs shadow-lg uppercase tracking-wider">
                                üóì ${month}
                            </span>
                        </div>
                        <div class="grid gap-6">
                            ${years[year][month].map(p => `
                                <div class="archive-card p-6 border-l-8 border-pink-400">
                                    <h2 class="text-lg font-bold text-slate-800 mb-2 leading-snug">${p.title}</h2>
                                    <p class="text-slate-500 text-[14px] line-clamp-2 mb-4 leading-relaxed">${p.content}</p>
                                    <button onclick="openFullPost('${p.key}')" class="text-pink-500 font-bold text-xs flex items-center gap-1 group">
                                        READ MEMORY <span class="group-hover:translate-x-1 transition-transform">‚Üí</span>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    yearSection.appendChild(monthGroup);
                });
                container.appendChild(yearSection);
            });
        });

        function openFullPost(key) {
            database.ref('allPosts/' + key).once('value').then((snap) => {
                const data = snap.val();
                document.getElementById('modal-title').innerText = data.title;
                document.getElementById('modal-content').innerText = data.content;
                document.getElementById('modal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    </script>
</body>
</html>