<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Archives</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Padauk', sans-serif; background: #f0f2f5; }
        .archive-card { background: #ffffff; border-radius: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); transition: transform 0.2s; }
        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: center; justify-content: center; padding: 15px; backdrop-filter: blur(8px); }
        .modal-content-box { white-space: pre-line; scrollbar-width: thin; scrollbar-color: #ec4899 #f3f4f6; }
    </style>
</head>
<body class="pb-10">

    <div class="max-w-[480px] mx-auto p-6">
        <header class="text-center mb-8">
            <h1 class="text-2xl font-bold text-pink-600 flex items-center justify-center gap-2">
                ğŸ“‚ á€¡á€™á€¾á€á€ºá€á€›á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸
            </h1>
        </header>

        <div id="archivesContainer" class="space-y-6">
            <div class="text-center text-slate-400 py-10">Loading memories...</div>
        </div>
    </div>

    <div id="modal" onclick="closeModal()">
        <div class="bg-white p-8 rounded-[2.5rem] max-w-[440px] w-full mx-4 shadow-2xl relative animate-in fade-in zoom-in duration-300" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-pink-600 font-bold mb-4 border-b pb-3 text-lg text-center"></h3>
            <div id="modal-content" class="modal-content-box text-black text-[17px] leading-[1.8] overflow-y-auto max-h-[450px] pr-2 text-justify font-bold"></div>
            <button onclick="closeModal()" class="mt-6 w-full bg-slate-900 text-white py-4 rounded-2xl font-bold uppercase tracking-widest active:scale-95 transition-all">Close</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCRUag3lfCii8IHnNGsW2TvcK-b8_YuqUY",
            authDomain: "oursecretdiary-d767a.firebaseapp.com",
            databaseURL: "https://oursecretdiary-d767a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "oursecretdiary-d767a",
            storageBucket: "oursecretdiary-d767a.firebasestorage.app",
            messagingSenderId: "610893709105",
            appId: "1:610893709105:web:ed7a66d562c8f2383cfa10"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Firebase á€€á€”á€± á€…á€¬á€…á€¯á€¡á€¬á€¸á€œá€¯á€¶á€¸á€†á€½á€²á€‘á€¯á€á€ºá€™á€šá€º
        database.ref('allPosts').on('value', (snap) => {
            const container = document.getElementById('archivesContainer');
            container.innerHTML = "";
            
            if(!snap.exists()) {
                container.innerHTML = "<p class='text-center text-slate-500'>á€¡á€™á€¾á€á€ºá€á€›á€™á€»á€¬á€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹</p>";
                return;
            }

            let posts = [];
            snap.forEach(c => {
                let data = c.val();
                data.key = c.key;
                posts.unshift(data); // á€¡á€á€…á€ºá€†á€¯á€¶á€¸á€…á€¬á€€á€­á€¯ á€¡á€•á€±á€«á€ºá€á€„á€ºá€™á€šá€º
            });

            posts.forEach(p => {
                // á€…á€¬á€á€¬á€¸á€€á€­á€¯ á€¡á€œá€¯á€¶á€¸ áá…á€ á€•á€²á€•á€¼á€™á€šá€º
                const shortContent = p.content.length > 150 ? p.content.substring(0, 150) + "..." : p.content;
                
                container.innerHTML += `
                    <div class="archive-card p-6 border border-pink-50">
                        <p class="text-[10px] text-pink-400 font-bold mb-2">2/20/2026</p>
                        <h2 class="text-lg font-bold text-slate-800 mb-3">${p.title}</h2>
                        <p class="text-slate-600 text-[14px] leading-relaxed mb-4">
                            ${shortContent}
                        </p>
                        <button onclick="openFullPost('${p.key}')" class="text-pink-500 font-bold text-sm flex items-center gap-1 hover:underline">
                            á€†á€€á€ºá€–á€á€ºá€›á€”á€º (Read More) â†’
                        </button>
                    </div>
                `;
            });
        });

        // Modal á€–á€½á€„á€·á€ºá€•á€±á€¸á€™á€šá€·á€º Function
        function openFullPost(key) {
            database.ref('allPosts/' + key).once('value').then((snap) => {
                const data = snap.val();
                document.getElementById('modal-title').innerText = data.title;
                document.getElementById('modal-content').innerText = data.content;
                document.getElementById('modal').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
    </script>
</body>
</html>